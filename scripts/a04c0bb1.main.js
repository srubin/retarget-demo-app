function PagePlayer(){var a,b,c=this,d=this,e=soundManager,f=null,g=null,h=document.getElementsByTagName("head")[0],i=null,j=navigator.userAgent,k=j.match(/(opera|firefox)/i),l=j.match(/ipad|ipod|iphone/i);this.config={usePeakData:!1,useWaveformData:!1,useEQData:!1,fillGraph:!1,allowRightClick:!0,useThrottling:!0,autoStart:!1,playNext:!0,updatePageTitle:!0,emptyTime:"-:--",useFavIcon:!1},this.css={sDefault:"sm2_link",sLoading:"sm2_loading",sPlaying:"sm2_playing",sPaused:"sm2_paused"},this.sounds=[],this.soundsByObject=[],this.lastSound=null,this.soundCount=0,this.strings=[],this.dragActive=!1,this.dragExec=new Date,this.dragTimer=null,this.pageTitle=document.title,this.lastWPExec=new Date,this.lastWLExec=new Date,this.vuMeterData=[],this.oControls=null,this._mergeObjects=function(a,b){var c,d,e,f={};for(d in a)a.hasOwnProperty(d)&&(f[d]=a[d]);c="undefined"==typeof b?{}:b;for(e in c)"undefined"==typeof f[e]&&(f[e]=c[e]);return f},a=function(){function a(a){var b=f.call(a),c=b.length;return e?(b[1]="on"+b[1],c>3&&b.pop()):3===c&&b.push(!1),b}function b(a,b){var c=a.shift(),d=[g[b]];e?c[d](a[0],a[1]):c[d].apply(c,a)}function c(){b(a(arguments),"add")}function d(){b(a(arguments),"remove")}var e=window.attachEvent&&!window.addEventListener,f=Array.prototype.slice,g={add:e?"attachEvent":"addEventListener",remove:e?"detachEvent":"removeEventListener"};return{add:c,remove:d}}(),this.hasClass=function(a,b){return"undefined"!=typeof a.className?new RegExp("(^|\\s)"+b+"(\\s|$)").test(a.className):!1},this.addClass=function(a,b){return a&&b&&!c.hasClass(a,b)?void(a.className=(a.className?a.className+" ":"")+b):!1},this.removeClass=function(a,b){return a&&b&&c.hasClass(a,b)?void(a.className=a.className.replace(new RegExp("( "+b+")|("+b+")","g"),"")):!1},this.select=function(a,b){var d=c.getByClassName(a,"div",b||null);return d?d[0]:null},this.getByClassName=document.querySelectorAll?function(a,b,c){var d,e="."+a;return b&&(b=b.split(" ")),d=b.length>1?b.join(e+", "):b[0]+e,(c?c:document).querySelectorAll(d)}:function(a,b,d){var e,f,g=d?d:document,h=[],i=[];if(b&&(b=b.split(" ")),b instanceof Array){for(e=b.length;e--;)i&&i[b[e]]||(i[b[e]]=g.getElementsByTagName(b[e]));for(e=b.length;e--;)for(f=i[b[e]].length;f--;)c.hasClass(i[b[e]][f],a)&&h.push(i[b[e]][f])}else for(i=g.all||g.getElementsByTagName("*"),e=0,f=i.length;f>e;e++)c.hasClass(i[e],a)&&h.push(i[e]);return h},this.isChildOfClass=function(a,b){if(!a||!b)return!1;for(;a.parentNode&&!c.hasClass(a,b);)a=a.parentNode;return c.hasClass(a,b)},this.getParentByNodeName=function(a,b){if(!a||!b)return!1;for(b=b.toLowerCase();a.parentNode&&b!==a.parentNode.nodeName.toLowerCase();)a=a.parentNode;return a.parentNode&&b===a.parentNode.nodeName.toLowerCase()?a.parentNode:null},this.getOffX=function(a){var b=0;if(a.offsetParent)for(;a.offsetParent;)b+=a.offsetLeft,a=a.offsetParent;else a.x&&(b+=a.x);return b},this.getTime=function(a,b){var c=Math.floor(a/1e3),d=Math.floor(c/60),e=c-60*d;return b?d+":"+(10>e?"0"+e:e):{min:d,sec:e}},this.getSoundByObject=function(a){return"undefined"!=typeof c.soundsByObject[a.id]?c.soundsByObject[a.id]:null},this.getPreviousItem=function(a){if(a.previousElementSibling)a=a.previousElementSibling;else for(a=a.previousSibling;a&&a.previousSibling&&1!==a.previousSibling.nodeType;)a=a.previousSibling;return"li"!==a.nodeName.toLowerCase()?null:a.getElementsByTagName("a")[0]},this.playPrevious=function(a){if(a||(a=c.lastSound),!a)return!1;var b=c.getPreviousItem(a._data.oLI);return b&&d.handleClick({target:b}),b},this.getNextItem=function(a){if(a.nextElementSibling)a=a.nextElementSibling;else for(a=a.nextSibling;a&&a.nextSibling&&1!==a.nextSibling.nodeType;)a=a.nextSibling;return"li"!==a.nodeName.toLowerCase()?null:a.getElementsByTagName("a")[0]},this.playNext=function(a){if(a||(a=c.lastSound),!a)return!1;var b=c.getNextItem(a._data.oLI);return b&&d.handleClick({target:b}),b},this.setPageTitle=function(a){if(!c.config.updatePageTitle)return!1;try{document.title=(a?a+" - ":"")+c.pageTitle}catch(b){c.setPageTitle=function(){return!1}}},this.events={play:function(){d.removeClass(this._data.oLI,this._data.className),this._data.className=d.css.sPlaying,d.addClass(this._data.oLI,this._data.className),c.setPageTitle(this._data.originalTitle)},stop:function(){d.removeClass(this._data.oLI,this._data.className),this._data.className="",this._data.oPosition.style.width="0px",c.setPageTitle(),c.resetPageIcon()},pause:function(){return d.dragActive?!1:(d.removeClass(this._data.oLI,this._data.className),this._data.className=d.css.sPaused,d.addClass(this._data.oLI,this._data.className),c.setPageTitle(),void c.resetPageIcon())},resume:function(){return d.dragActive?!1:(d.removeClass(this._data.oLI,this._data.className),this._data.className=d.css.sPlaying,void d.addClass(this._data.oLI,this._data.className))},finish:function(){d.removeClass(this._data.oLI,this._data.className),this._data.className="",this._data.oPosition.style.width="0px",c.config.playNext?d.playNext(this):(c.setPageTitle(),c.resetPageIcon())},whileloading:function(){function a(){this._data.oLoading.style.width=this.bytesLoaded/this.bytesTotal*100+"%",!this._data.didRefresh&&this._data.metadata&&(this._data.didRefresh=!0,this._data.metadata.refresh())}if(d.config.useThrottling){var b=new Date;(b&&b-c.lastWLExec>50||this.bytesLoaded===this.bytesTotal)&&(a.apply(this),c.lastWLExec=b)}else a.apply(this)},onload:function(){if(this.loaded)this._data.metadata&&this._data.metadata.refresh();else{var a=this._data.oLI.getElementsByTagName("a")[0],b=a.innerHTML;a.innerHTML=b+' <span style="font-size:0.5em"> | Load failed, d\'oh! '+(e.sandbox.noRemote?" Possible cause: Flash sandbox is denying remote URL access.":e.sandbox.noLocal?"Flash denying local filesystem access":"404?")+"</span>",setTimeout(function(){a.innerHTML=b},5e3)}},whileplaying:function(){var a=null;d.dragActive||!d.config.useThrottling?(c.updateTime.apply(this),e.flashVersion>=9&&(d.config.usePeakData&&this.instanceOptions.usePeakData&&c.updatePeaks.apply(this),(d.config.useWaveformData&&this.instanceOptions.useWaveformData||d.config.useEQData&&this.instanceOptions.useEQData)&&c.updateGraph.apply(this)),this._data.metadata&&(a=new Date,a&&a-c.lastWPExec>500&&(this._data.metadata.refreshMetadata(this),c.lastWPExec=a)),this._data.oPosition.style.width=this.position/c.getDurationEstimate(this)*100+"%"):(a=new Date,a-c.lastWPExec>30&&(c.updateTime.apply(this),e.flashVersion>=9&&(d.config.usePeakData&&this.instanceOptions.usePeakData&&c.updatePeaks.apply(this),(d.config.useWaveformData&&this.instanceOptions.useWaveformData||d.config.useEQData&&this.instanceOptions.useEQData)&&c.updateGraph.apply(this)),this._data.metadata&&this._data.metadata.refreshMetadata(this),this._data.oPosition.style.width=this.position/c.getDurationEstimate(this)*100+"%",c.lastWPExec=a))}},this.setPageIcon=function(a){if(!c.config.useFavIcon||!c.config.usePeakData||!a)return!1;var b=document.getElementById("sm2-favicon");b&&(h.removeChild(b),b=null),b||(b=document.createElement("link"),b.id="sm2-favicon",b.rel="shortcut icon",b.type="image/png",b.href=a,document.getElementsByTagName("head")[0].appendChild(b))},this.resetPageIcon=function(){if(!c.config.useFavIcon)return!1;var a=document.getElementById("favicon");a&&(a.href="/favicon.ico")},this.updatePeaks=function(){var a=this._data.oPeak,b=a.getElementsByTagName("span");b[0].style.marginTop=13-Math.floor(15*this.peakData.left)+"px",b[1].style.marginTop=13-Math.floor(15*this.peakData.right)+"px",e.flashVersion>8&&c.config.useFavIcon&&c.config.usePeakData&&c.setPageIcon(c.vuMeterData[parseInt(16*this.peakData.left,10)][parseInt(16*this.peakData.right,10)])},this.updateGraph=function(){if(d.config.flashVersion<9||!d.config.useWaveformData&&!d.config.useEQData)return!1;var a,b,c,e=this._data.oGraph.getElementsByTagName("div");if(d.config.useWaveformData)for(a=8,b=255;b--;)e[255-b].style.marginTop=1+a+Math.ceil(this.waveformData.left[b]*-a)+"px";else for(c=9,b=255;b--;)e[255-b].style.marginTop=2*c-1+Math.ceil(this.eqData[b]*-c)+"px"},this.resetGraph=function(){if(!d.config.useEQData||d.config.flashVersion<9)return!1;var a,b=this._data.oGraph.getElementsByTagName("div"),c=d.config.useEQData?"17px":"9px",e=d.config.fillGraph?"32px":"1px";for(a=255;a--;)b[255-a].style.marginTop=c,b[255-a].style.height=e},this.updateTime=function(){var a=c.strings.timing.replace("%s1",c.getTime(this.position,!0));a=a.replace("%s2",c.getTime(c.getDurationEstimate(this),!0)),this._data.oTiming.innerHTML=a},this.getTheDamnTarget=function(a){return a.target||(window.event?window.event.srcElement:null)},this.withinStatusBar=function(a){return c.isChildOfClass(a,"playlist")&&c.isChildOfClass(a,"controls")},this.handleClick=function(a){if(2===a.button)return d.config.allowRightClick||d.stopEvent(a),d.config.allowRightClick;var b,f,g,h,j,k,l=c.getTheDamnTarget(a);return l?(c.dragActive&&c.stopDrag(),c.withinStatusBar(l)?!1:("a"!==l.nodeName.toLowerCase()&&(l=c.getParentByNodeName(l,"a")),l?(b=l.getAttribute("href"),!l.href||!e.canPlayLink(l)&&!c.hasClass(l,"playable")||c.hasClass(l,"exclude")?!0:(c.initUL(c.getParentByNodeName(l,"ul")),c.initItem(l),f=l.href,g=c.getSoundByObject(l),g?(c.setPageTitle(g._data.originalTitle),g===c.lastSound?2!==g.readyState?1!==g.playState?g.play():g.togglePause():e._writeDebug("Warning: sound failed to load (security restrictions, 404 or bad format)",2):(c.lastSound&&c.stopSound(c.lastSound),i&&g._data.oTimingBox.appendChild(i),g.togglePause())):(g=e.createSound({id:l.id,url:decodeURI(f),onplay:c.events.play,onstop:c.events.stop,onpause:c.events.pause,onresume:c.events.resume,onfinish:c.events.finish,type:l.type||null,whileloading:c.events.whileloading,whileplaying:c.events.whileplaying,onmetadata:c.events.metadata,onload:c.events.onload}),h=c.oControls.cloneNode(!0),j=l.parentNode,j.appendChild(h),i&&j.appendChild(i),c.soundsByObject[l.id]=g,g._data={oLink:l,oLI:j,oControls:c.select("controls",j),oStatus:c.select("statusbar",j),oLoading:c.select("loading",j),oPosition:c.select("position",j),oTimingBox:c.select("timing",j),oTiming:c.select("timing",j).getElementsByTagName("div")[0],oPeak:c.select("peak",j),oGraph:c.select("spectrum-box",j),className:c.css.sPlaying,originalTitle:l.innerHTML,metadata:null},i&&g._data.oTimingBox.appendChild(i),g._data.oLI.getElementsByTagName("ul").length&&(g._data.metadata=new Metadata(g)),k=c.strings.timing.replace("%s1",c.config.emptyTime),k=k.replace("%s2",c.config.emptyTime),g._data.oTiming.innerHTML=k,c.sounds.push(g),c.lastSound&&c.stopSound(c.lastSound),c.resetGraph.apply(g),g.play()),c.lastSound=g,c.stopEvent(a))):!0)):!0},this.handleMouseDown=function(b){if(l&&b.touches&&(b=b.touches[0]),2===b.button)return d.config.allowRightClick||d.stopEvent(b),d.config.allowRightClick;var e=c.getTheDamnTarget(b);return e&&c.withinStatusBar(e)?(c.dragActive=!0,c.lastSound.pause(),c.setPosition(b),l?a.add(document,"touchmove",c.handleMouseMove):a.add(document,"mousemove",c.handleMouseMove),c.addClass(c.lastSound._data.oControls,"dragging"),c.stopEvent(b)):!0},this.handleMouseMove=function(a){if(l&&a.touches&&(a=a.touches[0]),c.dragActive)if(c.config.useThrottling){var b=new Date;b-c.dragExec>20?c.setPosition(a):(window.clearTimeout(c.dragTimer),c.dragTimer=window.setTimeout(function(){c.setPosition(a)},20)),c.dragExec=b}else c.setPosition(a);else c.stopDrag();return a.stopPropagation=!0,!1},this.stopDrag=function(b){return c.dragActive?(c.removeClass(c.lastSound._data.oControls,"dragging"),l?a.remove(document,"touchmove",c.handleMouseMove):a.remove(document,"mousemove",c.handleMouseMove),d.hasClass(c.lastSound._data.oLI,c.css.sPaused)||c.lastSound.resume(),c.dragActive=!1,c.stopEvent(b)):void 0},this.handleStatusClick=function(a){return c.setPosition(a),d.hasClass(c.lastSound._data.oLI,c.css.sPaused)||c.resume(),c.stopEvent(a)},this.stopEvent=function(a){return"undefined"!=typeof a&&("undefined"!=typeof a.preventDefault?a.preventDefault():(a.stopPropagation=!0,a.returnValue=!1)),!1},this.setPosition=function(a){var b,d,e,f,g=c.getTheDamnTarget(a);if(!g)return!0;for(d=g;!c.hasClass(d,"controls")&&d.parentNode;)d=d.parentNode;e=c.lastSound,b=parseInt(a.clientX,10),f=Math.floor((b-c.getOffX(d)-4)/d.offsetWidth*c.getDurationEstimate(e)),isNaN(f)||(f=Math.min(f,e.duration)),isNaN(f)||e.setPosition(f)},this.stopSound=function(a){e._writeDebug("stopping sound: "+a.id),e.stop(a.id),l||e.unload(a.id)},this.getDurationEstimate=function(a){return a.instanceOptions.isMovieStar?a.duration:a._data.metadata&&a._data.metadata.data.givenDuration?a._data.metadata.data.givenDuration:a.durationEstimate||0},this.createVUData=function(){var a,b,d=0,e=0,g=f.getContext("2d"),h=g.createLinearGradient(0,16,0,0);for(h.addColorStop(0,"rgb(0,192,0)"),h.addColorStop(.3,"rgb(0,255,0)"),h.addColorStop(.625,"rgb(255,255,0)"),h.addColorStop(.85,"rgb(255,0,0)"),a=g.createLinearGradient(0,16,0,0),b="rgba(0,0,0,0.2)",a.addColorStop(0,b),a.addColorStop(1,"rgba(0,0,0,0.5)"),d=0;16>d;d++)c.vuMeterData[d]=[];for(d=0;16>d;d++)for(e=0;16>e;e++)f.setAttribute("width",16),f.setAttribute("height",16),g.fillStyle=a,g.fillRect(0,0,7,15),g.fillRect(8,0,7,15),g.fillStyle=h,g.fillRect(0,15-d,7,16-(16-d)),g.fillRect(8,15-e,7,16-(16-e)),g.clearRect(0,3,16,1),g.clearRect(0,7,16,1),g.clearRect(0,11,16,1),c.vuMeterData[d][e]=f.toDataURL("image/png")},this.testCanvas=function(){var a,b=document.createElement("canvas"),c=null;if(!b||"undefined"==typeof b.getContext)return null;if(c=b.getContext("2d"),!c||"function"!=typeof b.toDataURL)return null;try{a=b.toDataURL("image/png")}catch(d){return null}return b},this.initItem=function(a){a.id||(a.id="pagePlayerMP3Sound"+c.soundCount++),c.addClass(a,c.css.sDefault)},this.initUL=function(a){e.flashVersion>=9&&c.addClass(a,c.cssBase)},this.init=function(h){function j(d){a[d](document,"click",c.handleClick),l?(a[d](document,"touchstart",c.handleMouseDown),a[d](document,"touchend",c.stopDrag)):(a[d](document,"mousedown",c.handleMouseDown),a[d](document,"mouseup",c.stopDrag)),a[d](window,"unload",b)}h?(e._writeDebug("pagePlayer.init(): Using custom configuration"),this.config=this._mergeObjects(h,this.config)):e._writeDebug("pagePlayer.init(): Using default configuration");var m,n,o,p,q,r;if(this.cssBase=[],e.useFlashBlock=!0,e.flashVersion>=9?(e.defaultOptions.usePeakData=this.config.usePeakData,e.defaultOptions.useWaveformData=this.config.useWaveformData,e.defaultOptions.useEQData=this.config.useEQData,this.config.usePeakData&&this.cssBase.push("use-peak"),(this.config.useWaveformData||this.config.useEQData)&&this.cssBase.push("use-spectrum"),this.cssBase=this.cssBase.join(" "),this.config.useFavIcon&&(f=c.testCanvas(),f&&k?c.createVUData():this.config.useFavIcon=!1)):(this.config.usePeakData||this.config.useWaveformData||this.config.useEQData)&&e._writeDebug("Page player: Note: soundManager.flashVersion = 9 is required for peak/waveform/EQ features."),g=document.createElement("div"),g.innerHTML=['  <div class="controls">','   <div class="statusbar">','    <div class="loading"></div>','    <div class="position"></div>',"   </div>","  </div>",'  <div class="timing">','   <div id="sm2_timing" class="timing-data">','    <span class="sm2_position">%s1</span> / <span class="sm2_total">%s2</span>',"   </div>","  </div>",'  <div class="peak">','   <div class="peak-box"><span class="l"></span><span class="r"></span></div>',"  </div>",' <div class="spectrum-container">','  <div class="spectrum-box">','   <div class="spectrum"></div>',"  </div>"," </div>"].join("\n"),e.flashVersion>=9){for(i=c.select("spectrum-container",g),i=g.removeChild(i),n=c.select("spectrum-box",i),o=n.getElementsByTagName("div")[0],p=document.createDocumentFragment(),q=null,m=256;m--;)q=o.cloneNode(!1),q.style.left=m+"px",p.appendChild(q);n.removeChild(o),n.appendChild(p)}else g.removeChild(c.select("spectrum-container",g)),g.removeChild(c.select("peak",g));c.oControls=g.cloneNode(!0),r=c.select("timing-data",g),c.strings.timing=r.innerHTML,r.innerHTML="",r.id="",b=function(){j("remove")},j("add"),e._writeDebug("pagePlayer.init(): Ready",1),c.config.autoStart&&d.handleClick({target:d.getByClassName("playlist","ul")[0].getElementsByTagName("a")[0]})}}var pagePlayer=null;soundManager.useFlashBlock=!0,soundManager.onready(function(){pagePlayer=new PagePlayer,pagePlayer.init("undefined"!=typeof PP_CONFIG?PP_CONFIG:null)}),function(){console.log("'Allo from CoffeeScript!")}.call(this);var RetargetTime=React.createClass({displayName:"RetargetTime",render:function(){return React.DOM.div({className:"well"},React.DOM.p({className:"lead"},"Target duration"),React.DOM.input({type:"number",placeholder:"minutes",size:"7",ref:"minutes",value:parseInt(this.state.seconds/60,10),onChange:this.onChange})," : ",React.DOM.input({type:"number",placeholder:"seconds",size:"7",ref:"seconds",value:parseInt(this.state.seconds%60,10),onChange:this.onChange}))},getInitialState:function(){return{seconds:parseInt(this.props.seconds,10)}},onChange:function(){var a=parseInt(this.refs.minutes.getDOMNode().value,10),b=parseInt(this.refs.seconds.getDOMNode().value,10);isNaN(a)&&(a=0),isNaN(b)&&(b=0);var c=60*a+b;console.log("total seconds",c),this.setState({seconds:c}),this.props.onChange(c)}}),RetargetSettings=React.createClass({displayName:"RetargetSettings",render:function(){return React.DOM.div({className:"well"},React.DOM.p({className:"lead"},"Settings"),React.DOM.input({type:"checkbox",name:"startAtStart",id:"startAtStart",checked:this.state.startAtStart,onChange:this.handleChange.bind(this,"startAtStart")},React.DOM.label({htmlFor:"startAtStart"}," Start at beginning of music")),React.DOM.br(null),React.DOM.input({type:"checkbox",name:"endAtEnd",id:"endAtEnd",checked:this.state.endAtEnd,onChange:this.handleChange.bind(this,"endAtEnd")},React.DOM.label({htmlFor:"endAtEnd"}," End at end of music (roughly)")))},getInitialState:function(){return{startAtStart:this.props.startAtStart,endAtEnd:this.props.endAtEnd}},handleChange:function(a,b){var c={};c[a]=b.target.checked,this.setState(c),this.props.onChange(c)}}),RetargetUploadForm=React.createClass({displayName:"RetargetUploadForm",render:function(){return React.DOM.form({id:"uploadForm",method:"POST",encType:"multipart/form-data"},React.DOM.div({className:"fileinput fileinput-new input-group","data-provides":"fileinput"},React.DOM.div({className:"form-control","data-trigger":"fileinput"},React.DOM.i({className:"glyphicon glyphicon-file fileinput-exists"}),React.DOM.span({className:"fileinput-filename"})),React.DOM.span({className:"input-group-addon btn btn-default btn-file"},React.DOM.span({className:"fileinput-new"},"Select music track"),React.DOM.span({className:"fileinput-exists"},"Change"),React.DOM.input({type:"file",name:"song"})),React.DOM.a({href:"#",className:"input-group-addon btn btn-default fileinput-exists","data-dismiss":"fileinput"},"Remove")))}}),Retarget=React.createClass({displayName:"Retarget",render:function(){var a="";""!==this.state.status&&(a=React.DOM.div({className:"alert alert-warning"}," ",this.state.status));var b={};return this.state.results.forEach(function(a){b["result-"+a.id]=React.DOM.li(null,React.DOM.a({href:a.url},a.text))}),React.DOM.div(null,React.DOM.div({className:"col-lg-6"},React.DOM.div({className:"well"},React.DOM.p({className:"lead"},"Music"),RetargetUploadForm({onChange:this.dirtyTrack}),React.DOM.input({type:"text",value:this.state.trackName,onChange:this.updateTrackName})),RetargetTime({onChange:this.updateTime,seconds:90}),RetargetSettings({onChange:this.updateSettings,startAtStart:!0,endAtEnd:!0})),React.DOM.div({className:"col-lg-6"},React.DOM.div({className:"row"},React.DOM.div({className:"col-lg-6"},React.DOM.div(null,React.DOM.button({onClick:this.retarget,className:"btn btn-success btn-block btn-lg"},"Retarget"))),React.DOM.div({className:"col-lg-6"},React.DOM.div(null,React.DOM.button({onClick:this.clearResults,className:"btn btn-block btn-lg"},"Clear all results")))),React.DOM.div(null,a,React.DOM.ul({className:"playlist"},b))))},getInitialState:function(){return{status:"",results:[],seconds:90,trackName:"Track name",startAtStart:!0,endAtEnd:!0,uploadedTrack:!1,trackPath:null,fileinputFilename:null}},updateTrackName:function(a){this.setState({trackName:a.target.value})},updateTime:function(a){this.setState({seconds:a})},updateSettings:function(a){this.setState(a)},getName:function(a){var b="freeStart",c="freeEnd";this.state.startAtStart&&(b="fixStart"),this.state.endAtEnd&&(c="fixEnd");var d=""+this.state.trackName+" ("+this.state.seconds+", "+b+", "+c+")";return d+="Transitions: ",a.forEach(function(a){d+=a[0]+"sec, c: "+a[1]+"; "}),d},componentDidMount:function(){var a=this;$("#uploadForm").submit(function(b){var c=new FormData($("#uploadForm")[0]);a.setState({status:"Uploading track"}),$.ajax({type:"POST",url:"/retarget-service/uploadTrack",data:c,cache:!1,contentType:!1,processData:!1,success:function(b){a.setState({uploadedTrack:!0,trackName:b.title,trackPath:b.filename}),a._retargetFn()},error:function(){a.setState({status:"Could not upload track. Select an mp3 to upload"}),a.state.spinner.stop()}}),b.preventDefault()})},_retargetFn:function(){this.setState({status:"Retargeting track (this can take several minutes if it's the first time retargeting this track)"});var a="no",b="no";this.state.startAtStart&&(a="start"),this.state.endAtEnd&&(b="end");var c="/retarget-service/retarget/"+this.state.trackPath+"/"+this.state.seconds+"/"+a+"/"+b,d=this;$.ajax({type:"GET",url:c,success:function(a){var b=d.state.results;b.push({text:d.getName(a.transitions),url:a.url,id:""+Math.random()}),d.setState({results:b}),d.state.spinner.stop(),d.setState({status:""})},error:function(){d.setState({status:"Could not retarget track."}),d.state.spinner.stop()}})},clearResults:function(){this.setState({results:[]})},retarget:function(){var a={lines:9,length:0,width:16,radius:36,corners:1,rotate:0,direction:1,color:"#000",speed:1.2,trail:45,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"50%",left:"50%"};this.setState({spinner:new Spinner(a).spin($("body")[0])});var b=$(".fileinput-filename").text(),c=!1;if(b!==this.state.fileinputFilename){console.log("Must upload new file"),this.setState({fileinputFilename:b,uploadedTrack:!1,trackPath:null}),console.log(this.state);var c=!0}c?$("#uploadForm").submit():this._retargetFn()}});React.renderComponent(Retarget(null),document.getElementById("retarget"));